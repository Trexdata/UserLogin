var LocalStrategy=require("passport-local").Strategy,User=require("../app/models/user");module.exports=function(e){e.serializeUser(function(e,a){a(null,e.id)}),e.deserializeUser(function(e,a){User.findById(e,function(e,r){a(e,r)})}),e.use("local-signup",new LocalStrategy({usernameField:"email",passwordField:"password",passReqToCallback:!0},function(e,a,r,n){process.nextTick(function(){User.findOne({"local.email":a},function(s,l){if(s)return n(s);if(l)return n(null,!1,e.flash("signupMessage","That email is already taken."));var i=new User;i.local.email=a,i.local.password=i.generateHash(r),i.save(function(e){if(e)throw e;return n(null,i)})})})}))};